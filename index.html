<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bookmarklet Generator</title>
  <style>
    :root {
      --bg-light: #f4f4f9;
      --bg-dark: #181920;
      --container-light: #fff;
      --container-dark: #23232b;
      --text-light: #222;
      --text-dark: #eee;
      --primary: #007BFF;
      --primary-dark: #0056b3;
      --success: #28a745;
      --success-dark: #218838;
    }
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: var(--bg-light);
      color: var(--text-light);
      transition: background 0.3s, color 0.3s;
    }
    body.dark-mode {
      background-color: var(--bg-dark);
      color: var(--text-dark);
    }
    .container {
      background: var(--container-light);
      padding: 24px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 480px;
      transition: background 0.3s;
    }
    body.dark-mode .container {
      background: var(--container-dark);
    }
    h1 {
      margin-bottom: 18px;
    }
    .actions-panel {
      display: flex;
      gap: 10px;
      margin-bottom: 18px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .action-block {
      background: #eee;
      border-radius: 8px;
      padding: 10px;
      min-width: 120px;
      cursor: grab;
      border: 2px solid transparent;
      margin: 4px 0;
      transition: background 0.2s, border 0.2s;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    body.dark-mode .action-block {
      background: #31313d;
      color: var(--text-dark);
    }
    .action-block.dragging {
      opacity: 0.6;
      border: 2px dashed var(--primary);
    }
    .sequence-area {
      min-height: 56px;
      background: #f9f9f9;
      border: 2px dashed #bbb;
      border-radius: 8px;
      margin-bottom: 12px;
      padding: 12px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      transition: background 0.3s;
    }
    body.dark-mode .sequence-area {
      background: #22222a;
    }
    .sequence-block {
      background: #fff;
      border: 1px solid #bbb;
      border-radius: 5px;
      padding: 8px;
      min-width: 110px;
      margin: 4px 0;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.07);
    }
    body.dark-mode .sequence-block {
      background: #30303b;
      color: var(--text-dark);
      border: 1px solid #444;
    }
    .remove-seq-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      background: #d9534f;
      color: white;
      border: none;
      border-radius: 3px;
      padding: 2px 7px;
      cursor: pointer;
      font-size: 13px;
    }
    .remove-seq-btn:hover {
      background: #c9302c;
    }
    .block-input, .block-select {
      width: 100%;
      margin-top: 6px;
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 15px;
      box-sizing: border-box;
    }
    .answer-actions-list {
      width: 100%;
      margin-top: 6px;
      margin-bottom: 4px;
    }
    .answer-action-row {
      display: flex;
      gap: 6px;
      margin-bottom: 4px;
      align-items: center;
    }
    .answer-action-row input, .answer-action-row select {
      margin: 0;
      padding: 4px;
      font-size: 14px;
    }
    .remove-answer-btn {
      background: #d9534f;
      color: white;
      border: none;
      border-radius: 3px;
      padding: 2px 7px;
      cursor: pointer;
      font-size: 13px;
    }
    .remove-answer-btn:hover {
      background: #c9302c;
    }
    .add-answer-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 3px;
      padding: 4px 10px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 3px;
    }
    .add-answer-btn:hover {
      background: var(--primary-dark);
    }
    .toggle-dark {
      margin-top: 6px;
      margin-bottom: 16px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 5px;
      padding: 7px 14px;
      cursor: pointer;
    }
    .toggle-dark:hover {
      background: var(--primary-dark);
    }
    #generateButton, #copyButton {
      margin-top: 18px;
      padding: 10px 22px;
      background-color: var(--success);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #generateButton:hover, #copyButton:hover {
      background-color: var(--success-dark);
    }
    #bookmarkletOutput {
      margin-top: 13px;
      width: 100%;
      padding: 8px;
      font-size: 15px;
      border: 1px solid #bbb;
      border-radius: 4px;
      background: #f9f9f9;
      color: #333;
      box-sizing: border-box;
    }
    body.dark-mode #bookmarkletOutput {
      background: #23232b;
      color: #eee;
      border: 1px solid #444;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Bookmarklet Generator</h1>
    <button class="toggle-dark" id="toggleDarkBtn">Toggle Dark Mode</button>
    <div class="actions-panel" id="actionsPanel">
      <div class="action-block" draggable="true" data-action="alert">
        üîî Alert<br>
        <input type="text" class="block-input" placeholder="Message" />
      </div>
      <div class="action-block" draggable="true" data-action="log">
        üìù Log<br>
        <input type="text" class="block-input" placeholder="Log message" />
      </div>
      <div class="action-block" draggable="true" data-action="changeBg">
        üé® Change BG<br>
        <input type="text" class="block-input" placeholder="Color e.g. #ff0" />
      </div>
      <div class="action-block" draggable="true" data-action="prompt">
        ‚ùì Prompt<br>
        <input type="text" class="block-input" placeholder="Prompt message" />
        <div class="answer-actions-list"></div>
        <button type="button" class="add-answer-btn">Add answer</button>
      </div>
    </div>
    <div>
      <h3>Sequence (Drag actions here in order):</h3>
      <div class="sequence-area" id="sequenceArea"></div>
    </div>
    <button type="button" id="generateButton">Generate Bookmarklet</button>
    <input type="text" id="bookmarkletOutput" readonly placeholder="Your bookmarklet will appear here">
    <button type="button" id="copyButton">Copy to Clipboard</button>
  </div>
  <script>
    // Dark mode toggle
    const toggleDarkBtn = document.getElementById('toggleDarkBtn');
    toggleDarkBtn.onclick = () => {
      document.body.classList.toggle('dark-mode');
    };

    // Helper to add answer-action row to a block
    function addAnswerRow(listElem, answer = '', action = 'alert', actionVal = '') {
      const row = document.createElement('div');
      row.className = 'answer-action-row';

      const answerInput = document.createElement('input');
      answerInput.className = 'block-input';
      answerInput.type = 'text';
      answerInput.placeholder = 'Answer value';
      answerInput.value = answer;

      const actionSelect = document.createElement('select');
      actionSelect.className = 'block-select';
      ['alert','log','changeBg'].forEach(opt=>{
        const o = document.createElement('option');
        o.value = opt;
        o.textContent = ({
          'alert': 'Alert',
          'log': 'Log',
          'changeBg': 'Change BG'
        })[opt];
        actionSelect.appendChild(o);
      });
      actionSelect.value = action;

      const actionValInput = document.createElement('input');
      actionValInput.className = 'block-input';
      actionValInput.type = 'text';
      actionValInput.placeholder = 'Action value';
      actionValInput.value = actionVal;

      const removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.className = 'remove-answer-btn';
      removeBtn.textContent = '‚úï';
      removeBtn.onclick = () => row.remove();

      row.appendChild(answerInput);
      row.appendChild(actionSelect);
      row.appendChild(actionValInput);
      row.appendChild(removeBtn);

      listElem.appendChild(row);
    }

    // Drag and drop
    let draggedBlock = null;
    const actionsPanel = document.getElementById('actionsPanel');
    const sequenceArea = document.getElementById('sequenceArea');

    actionsPanel.addEventListener('dragstart', function(e) {
      if (e.target.classList.contains('action-block')) {
        draggedBlock = e.target;
        e.target.classList.add('dragging');
      }
    });
    actionsPanel.addEventListener('dragend', function(e) {
      if (draggedBlock) draggedBlock.classList.remove('dragging');
      draggedBlock = null;
    });

    sequenceArea.addEventListener('dragover', function(e) {
      e.preventDefault();
    });
    sequenceArea.addEventListener('drop', function(e) {
      e.preventDefault();
      if (!draggedBlock) return;
      // Clone the block into the sequence area
      const clone = draggedBlock.cloneNode(true);
      clone.className = 'sequence-block';

      // Remove draggable, add remove button
      clone.removeAttribute('draggable');
      const removeBtn = document.createElement('button');
      removeBtn.textContent = '‚úï';
      removeBtn.className = 'remove-seq-btn';
      removeBtn.onclick = () => clone.remove();
      clone.appendChild(removeBtn);

      // Make inputs/selects usable and enable answer-action events for prompt blocks
      Array.from(clone.querySelectorAll('input,select')).forEach(node => node.disabled = false);

      if (clone.dataset.action === 'prompt') {
        // Setup answer-action list and add-answer button
        const listElem = clone.querySelector('.answer-actions-list');
        listElem.innerHTML = '';
        // If original block has rows, clone them
        const origList = draggedBlock.querySelector('.answer-actions-list');
        if (origList && origList.children.length) {
          Array.from(origList.children).forEach(origRow => {
            const origInputs = origRow.querySelectorAll('input,select');
            addAnswerRow(listElem,
              origInputs[0]?.value || '',
              origInputs[1]?.value || 'alert',
              origInputs[2]?.value || ''
            );
          });
        } else {
          // Add default one row if none exist
          addAnswerRow(listElem);
        }
        // Add-answer button
        const addBtn = clone.querySelector('.add-answer-btn');
        addBtn.onclick = () => addAnswerRow(listElem);
      }

      sequenceArea.appendChild(clone);
    });

    // Initial setup for action-panel prompt block
    window.addEventListener('DOMContentLoaded', () => {
      const promptBlock = actionsPanel.querySelector('.action-block[data-action="prompt"]');
      const listElem = promptBlock.querySelector('.answer-actions-list');
      listElem.innerHTML = '';
      addAnswerRow(listElem);
      const addBtn = promptBlock.querySelector('.add-answer-btn');
      addBtn.onclick = () => addAnswerRow(listElem);
    });

    // Generate bookmarklet code
    document.getElementById('generateButton').onclick = function() {
      const blocks = Array.from(sequenceArea.getElementsByClassName('sequence-block'));
      if (!blocks.length) return alert('Add at least one action to the sequence.');

      let codeSteps = [];
      for (let block of blocks) {
        const type = block.dataset.action;
        if (type === 'alert') {
          const msg = block.querySelector('.block-input').value.trim();
          codeSteps.push(`alert(${JSON.stringify(msg)});`);
        } else if (type === 'log') {
          const msg = block.querySelector('.block-input').value.trim();
          codeSteps.push(`console.log(${JSON.stringify(msg)});`);
        } else if (type === 'changeBg') {
          const color = block.querySelector('.block-input').value.trim();
          codeSteps.push(`document.body.style.backgroundColor=${JSON.stringify(color)};`);
        } else if (type === 'prompt') {
          const promptMsg = block.querySelector('.block-input').value.trim();
          codeSteps.push(`var ans=prompt(${JSON.stringify(promptMsg)});`);
          const listElem = block.querySelector('.answer-actions-list');
          Array.from(listElem.children).forEach(row => {
            const inputs = row.querySelectorAll('input,select');
            const answerVal = inputs[0].value.trim();
            const actionType = inputs[1].value;
            const actionVal = inputs[2].value.trim();
            if (!answerVal) return;
            if (actionType === 'alert') {
              codeSteps.push(`if(ans===${JSON.stringify(answerVal)}){alert(${JSON.stringify(actionVal)});} `);
            } else if (actionType === 'log') {
              codeSteps.push(`if(ans===${JSON.stringify(answerVal)}){console.log(${JSON.stringify(actionVal)});} `);
            } else if (actionType === 'changeBg') {
              codeSteps.push(`if(ans===${JSON.stringify(answerVal)}){document.body.style.backgroundColor=${JSON.stringify(actionVal)};} `);
            }
          });
        }
      }
      const bookmarkletCode = 'javascript:(function(){' + codeSteps.join(' ') + '})();';
      document.getElementById('bookmarkletOutput').value = bookmarkletCode.replace(/\s+/g, ' ');
    };

    // Copy to clipboard
    document.getElementById('copyButton').onclick = function() {
      const outputField = document.getElementById('bookmarkletOutput');
      outputField.select();
      outputField.setSelectionRange(0, 99999); // For mobile devices
      navigator.clipboard.writeText(outputField.value).then(() => {
        alert('Bookmarklet copied to clipboard!');
      }).catch(err => {
        console.error('Failed to copy bookmarklet:', err);
      });
    };
  </script>
</body>
</html>
