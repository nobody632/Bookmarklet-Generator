<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bookmarklet Generator</title>
  <style>
    :root {
      --bg-light: #f4f4f9;
      --bg-dark: #181920;
      --container-light: #fff;
      --container-dark: #23232b;
      --text-light: #222;
      --text-dark: #eee;
      --primary: #007BFF;
      --primary-dark: #0056b3;
      --success: #28a745;
      --success-dark: #218838;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    body {
      min-height: 100vh;
      min-width: 100vw;
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      background-color: var(--bg-light);
      color: var(--text-light);
      transition: background 0.3s, color 0.3s;
      box-sizing: border-box;
      overflow: auto;
    }
    body.dark-mode {
      background-color: var(--bg-dark);
      color: var(--text-dark);
    }
    .container {
      box-sizing: border-box;
      background: var(--container-light);
      padding: 0;
      width: 100vw;
      min-width: 100vw;
      min-height: 100vh;
      border-radius: 0;
      box-shadow: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      transition: background 0.3s;
    }
    body.dark-mode .container {
      background: var(--container-dark);
    }
    h1 {
      margin-top: 32px;
      margin-bottom: 18px;
      font-size: 2.2rem;
      width: 100%;
      text-align: center;
    }
    .main-flex {
      width: 100vw;
      flex: 1 1 0;
      display: flex;
      gap: 24px;
      align-items: flex-start;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
      box-sizing: border-box;
    }
    .actions-panel, .sequence-panel {
      flex: 1 1 0;
      min-width: 320px;
      max-width: 520px;
      padding: 18px 12px;
      box-sizing: border-box;
    }
    @media (max-width: 950px) {
      .main-flex { flex-direction: column; align-items: stretch;}
      .actions-panel, .sequence-panel { max-width: 100%; }
    }
    .actions-panel {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .actions-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .action-block {
      background: #eee;
      border-radius: 8px;
      padding: 10px;
      min-width: 120px;
      cursor: grab;
      border: 2px solid transparent;
      margin: 4px 0;
      transition: background 0.2s, border 0.2s;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    body.dark-mode .action-block {
      background: #31313d;
      color: var(--text-dark);
    }
    .action-block.dragging {
      opacity: 0.6;
      border: 2px dashed var(--primary);
    }
    .sequence-panel h3 {
      margin-bottom: 8px;
    }
    .sequence-area {
      min-height: 56px;
      background: #f9f9f9;
      border: 2px dashed #bbb;
      border-radius: 8px;
      margin-bottom: 12px;
      padding: 12px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      transition: background 0.3s;
      min-width: 320px;
      box-sizing: border-box;
    }
    body.dark-mode .sequence-area {
      background: #22222a;
    }
    .sequence-block {
      background: #fff;
      border: 1px solid #bbb;
      border-radius: 5px;
      padding: 8px;
      min-width: 110px;
      margin: 4px 0;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.07);
    }
    body.dark-mode .sequence-block {
      background: #30303b;
      color: var(--text-dark);
      border: 1px solid #444;
    }
    .remove-seq-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      background: #d9534f;
      color: white;
      border: none;
      border-radius: 3px;
      padding: 2px 7px;
      cursor: pointer;
      font-size: 13px;
    }
    .remove-seq-btn:hover {
      background: #c9302c;
    }
    .block-input, .block-select {
      width: 100%;
      margin-top: 6px;
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 15px;
      box-sizing: border-box;
    }
    .answer-actions-list {
      width: 100%;
      margin-top: 6px;
      margin-bottom: 4px;
    }
    .answer-action-row {
      display: flex;
      gap: 6px;
      margin-bottom: 4px;
      align-items: center;
    }
    .answer-action-row input, .answer-action-row select {
      margin: 0;
      padding: 4px;
      font-size: 14px;
    }
    .remove-answer-btn {
      background: #d9534f;
      color: white;
      border: none;
      border-radius: 3px;
      padding: 2px 7px;
      cursor: pointer;
      font-size: 13px;
    }
    .remove-answer-btn:hover {
      background: #c9302c;
    }
    .add-answer-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 3px;
      padding: 4px 10px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 3px;
    }
    .add-answer-btn:hover {
      background: var(--primary-dark);
    }
    .toggle-dark {
      margin-top: 6px;
      margin-bottom: 16px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 5px;
      padding: 7px 14px;
      cursor: pointer;
    }
    .toggle-dark:hover {
      background: var(--primary-dark);
    }
    #generateButton, #copyButton {
      margin-top: 18px;
      padding: 10px 22px;
      background-color: var(--success);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #generateButton:hover, #copyButton:hover {
      background-color: var(--success-dark);
    }
    #bookmarkletOutput {
      margin-top: 13px;
      width: 100%;
      max-width: 700px;
      padding: 8px;
      font-size: 15px;
      border: 1px solid #bbb;
      border-radius: 4px;
      background: #f9f9f9;
      color: #333;
      box-sizing: border-box;
    }
    body.dark-mode #bookmarkletOutput {
      background: #23232b;
      color: #eee;
      border: 1px solid #444;
    }
    ::-webkit-scrollbar { width: 8px; background: transparent;}
    ::-webkit-scrollbar-thumb { background: #ccc; border-radius:4px;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Bookmarklet Generator</h1>
    <button class="toggle-dark" id="toggleDarkBtn">Toggle Dark Mode</button>
    <div class="main-flex">
      <div class="actions-panel" id="actionsPanel">
        <div class="actions-list">
          <div class="action-block" draggable="true" data-action="alert">
            üîî Alert<br>
            <input type="text" class="block-input" placeholder="Message" />
          </div>
          <div class="action-block" draggable="true" data-action="log">
            üìù Log<br>
            <input type="text" class="block-input" placeholder="Log message" />
          </div>
          <div class="action-block" draggable="true" data-action="changeBg">
            üé® Change BG<br>
            <input type="text" class="block-input" placeholder="Color e.g. #ff0" />
          </div>
          <div class="action-block" draggable="true" data-action="prompt">
            ‚ùì Prompt<br>
            <input type="text" class="block-input" placeholder="Prompt message" />
            <div class="answer-actions-list"></div>
            <button type="button" class="add-answer-btn">Add answer</button>
            <!-- "Add Else" button added dynamically in JS -->
          </div>
          <div class="action-block" draggable="true" data-action="hideImages">
            üñºÔ∏è Hide Images
          </div>
          <div class="action-block" draggable="true" data-action="replaceWords">
            üîÑ Replace Words<br>
            <input type="text" class="block-input" placeholder="Find this word" />
            <input type="text" class="block-input" placeholder="Replace with" />
          </div>
          <div class="action-block" draggable="true" data-action="insertText">
            üè∑Ô∏è Insert Text<br>
            <input type="text" class="block-input" placeholder="Text to insert" />
            <select class="block-select">
              <option value="top">Top</option>
              <option value="bottom">Bottom</option>
            </select>
          </div>
          <!-- New Fun Visual Effects Block -->
          <div class="action-block" draggable="true" data-action="visualEffect">
            üéâ Fun Effect<br>
            <select class="block-select">
              <option value="danceParty">Dance Party</option>
              <option value="confetti">Confetti Explosion</option>
              <option value="invertColors">Invert Colors</option>
              <option value="rainbowBg">Rainbow Background</option>
              <option value="shakeEverything">Shake Everything</option>
            </select>
          </div>
        </div>
      </div>
      <div class="sequence-panel">
        <h3>Sequence (Drag actions here in order):</h3>
        <div class="sequence-area" id="sequenceArea"></div>
      </div>
    </div>
    <button type="button" id="generateButton">Generate Bookmarklet</button>
    <input type="text" id="bookmarkletOutput" readonly placeholder="Your bookmarklet will appear here">
    <button type="button" id="copyButton">Copy to Clipboard</button>
  </div>
  <script>
    // Dark mode toggle
    const toggleDarkBtn = document.getElementById('toggleDarkBtn');
    toggleDarkBtn.onclick = () => {
      document.body.classList.toggle('dark-mode');
    };

    // Helper to add answer-action row to a block
    function addAnswerRow(listElem, answer = '', action = 'alert', actionVal = '') {
      const row = document.createElement('div');
      row.className = 'answer-action-row';

      const answerInput = document.createElement('input');
      answerInput.className = 'block-input';
      answerInput.type = 'text';
      answerInput.placeholder = 'Answer value';
      answerInput.value = answer;

      const actionSelect = document.createElement('select');
      actionSelect.className = 'block-select';
      ['alert','log','changeBg'].forEach(opt=>{
        const o = document.createElement('option');
        o.value = opt;
        o.textContent = ({
          'alert': 'Alert',
          'log': 'Log',
          'changeBg': 'Change BG'
        })[opt];
        actionSelect.appendChild(o);
      });
      actionSelect.value = action;

      const actionValInput = document.createElement('input');
      actionValInput.className = 'block-input';
      actionValInput.type = 'text';
      actionValInput.placeholder = 'Action value';
      actionValInput.value = actionVal;

      const removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.className = 'remove-answer-btn';
      removeBtn.textContent = '‚úï';
      removeBtn.onclick = () => row.remove();

      row.appendChild(answerInput);
      row.appendChild(actionSelect);
      row.appendChild(actionValInput);
      row.appendChild(removeBtn);

      listElem.appendChild(row);
    }

    // Helper to add Else-action row to a block
    function addElseRow(listElem, action = 'alert', actionVal = '') {
      // Prevent duplicate Else row
      if (listElem.querySelector('.else-action-row')) return;

      const row = document.createElement('div');
      row.className = 'answer-action-row else-action-row';

      const label = document.createElement('span');
      label.textContent = 'Else:';
      label.style.marginRight = '8px';
      label.style.fontWeight = 'bold';

      const actionSelect = document.createElement('select');
      actionSelect.className = 'block-select';
      ['alert','log','changeBg'].forEach(opt=>{
        const o = document.createElement('option');
        o.value = opt;
        o.textContent = ({
          'alert': 'Alert',
          'log': 'Log',
          'changeBg': 'Change BG'
        })[opt];
        actionSelect.appendChild(o);
      });
      actionSelect.value = action;

      const actionValInput = document.createElement('input');
      actionValInput.className = 'block-input';
      actionValInput.type = 'text';
      actionValInput.placeholder = 'Action value';
      actionValInput.value = actionVal;

      const removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.className = 'remove-answer-btn';
      removeBtn.textContent = '‚úï';
      removeBtn.onclick = () => row.remove();

      row.appendChild(label);
      row.appendChild(actionSelect);
      row.appendChild(actionValInput);
      row.appendChild(removeBtn);

      listElem.appendChild(row);

      // Remove the Add Else button once else is added
      const parent = listElem.parentNode;
      const addElseBtn = parent.querySelector('.add-answer-btn[data-else-btn]');
      if (addElseBtn) addElseBtn.remove();
    }

    // Drag and drop
    let draggedBlock = null;
    const actionsPanel = document.getElementById('actionsPanel');
    const sequenceArea = document.getElementById('sequenceArea');

    actionsPanel.addEventListener('dragstart', function(e) {
      if (e.target.classList.contains('action-block')) {
        draggedBlock = e.target;
        e.target.classList.add('dragging');
      }
    });
    actionsPanel.addEventListener('dragend', function(e) {
      if (draggedBlock) draggedBlock.classList.remove('dragging');
      draggedBlock = null;
    });

    sequenceArea.addEventListener('dragover', function(e) {
      e.preventDefault();
    });
    sequenceArea.addEventListener('drop', function(e) {
      e.preventDefault();
      if (!draggedBlock) return;
      // Clone the block into the sequence area
      const clone = draggedBlock.cloneNode(true);
      clone.className = 'sequence-block';

      // Remove draggable, add remove button
      clone.removeAttribute('draggable');
      const removeBtn = document.createElement('button');
      removeBtn.textContent = '‚úï';
      removeBtn.className = 'remove-seq-btn';
      removeBtn.onclick = () => clone.remove();
      clone.appendChild(removeBtn);

      // Make inputs/selects usable and enable answer-action events for prompt blocks
      Array.from(clone.querySelectorAll('input,select')).forEach(node => node.disabled = false);

      if (clone.dataset.action === 'prompt') {
        // Setup answer-action list and add-answer button
        const listElem = clone.querySelector('.answer-actions-list');
        listElem.innerHTML = '';
        // If original block has rows, clone them
        const origList = draggedBlock.querySelector('.answer-actions-list');
        if (origList && origList.children.length) {
          Array.from(origList.children).forEach(origRow => {
            if (origRow.classList.contains('else-action-row')) {
              const origInputs = origRow.querySelectorAll('select,input');
              addElseRow(listElem,
                origInputs[0]?.value || 'alert',
                origInputs[1]?.value || ''
              );
            } else {
              const origInputs = origRow.querySelectorAll('input,select');
              addAnswerRow(listElem,
                origInputs[0]?.value || '',
                origInputs[1]?.value || 'alert',
                origInputs[2]?.value || ''
              );
            }
          });
        } else {
          // Add default one row if none exist
          addAnswerRow(listElem);
        }
        // Add-answer button
        const addBtn = clone.querySelector('.add-answer-btn');
        addBtn.onclick = () => addAnswerRow(listElem);

        // Add Else button (with special attribute)
        const addElseBtn = document.createElement('button');
        addElseBtn.type = 'button';
        addElseBtn.className = 'add-answer-btn';
        addElseBtn.textContent = 'Add Else';
        addElseBtn.style.marginLeft = '8px';
        addElseBtn.setAttribute('data-else-btn', 'true');
        addElseBtn.onclick = () => addElseRow(listElem);

        addBtn.parentNode.insertBefore(addElseBtn, addBtn.nextSibling);
      }

      sequenceArea.appendChild(clone);
    });

    // Initial setup for action-panel prompt block
    window.addEventListener('DOMContentLoaded', () => {
      const promptBlock = actionsPanel.querySelector('.action-block[data-action="prompt"]');
      const listElem = promptBlock.querySelector('.answer-actions-list');
      listElem.innerHTML = '';
      addAnswerRow(listElem);
      const addBtn = promptBlock.querySelector('.add-answer-btn');
      addBtn.onclick = () => addAnswerRow(listElem);

      // Add Else button to promptBlock (with special attribute)
      const addElseBtn = document.createElement('button');
      addElseBtn.type = 'button';
      addElseBtn.className = 'add-answer-btn';
      addElseBtn.textContent = 'Add Else';
      addElseBtn.style.marginLeft = '8px';
      addElseBtn.setAttribute('data-else-btn', 'true');
      addElseBtn.onclick = () => addElseRow(listElem);
      addBtn.parentNode.insertBefore(addElseBtn, addBtn.nextSibling);
    });

    // Generate bookmarklet code
    document.getElementById('generateButton').onclick = function() {
      const blocks = Array.from(sequenceArea.getElementsByClassName('sequence-block'));
      if (!blocks.length) return alert('Add at least one action to the sequence.');

      let codeSteps = [];
      for (let block of blocks) {
        const type = block.dataset.action;
        if (type === 'alert') {
          const msg = block.querySelector('.block-input').value.trim();
          codeSteps.push(`alert(${JSON.stringify(msg)});`);
        } else if (type === 'log') {
          const msg = block.querySelector('.block-input').value.trim();
          codeSteps.push(`console.log(${JSON.stringify(msg)});`);
        } else if (type === 'changeBg') {
          const color = block.querySelector('.block-input').value.trim();
          codeSteps.push(`document.body.style.backgroundColor=${JSON.stringify(color)};`);
        } else if (type === 'prompt') {
          const promptMsg = block.querySelector('.block-input').value.trim();
          codeSteps.push(`var ans=prompt(${JSON.stringify(promptMsg)});`);
          const listElem = block.querySelector('.answer-actions-list');

          // Collect answer rows (not Else)
          const answerRows = Array.from(listElem.children).filter(row => !row.classList.contains('else-action-row'));
          let conditions = [];
          answerRows.forEach(row => {
            const inputs = row.querySelectorAll('input,select');
            const answerVal = inputs[0].value.trim();
            const actionType = inputs[1].value;
            const actionVal = inputs[2].value.trim();
            if (!answerVal) return;
            let actionCode = '';
            if (actionType === 'alert') {
              actionCode = `alert(${JSON.stringify(actionVal)});`;
            } else if (actionType === 'log') {
              actionCode = `console.log(${JSON.stringify(actionVal)});`;
            } else if (actionType === 'changeBg') {
              actionCode = `document.body.style.backgroundColor=${JSON.stringify(actionVal)};`;
            }
            conditions.push(`if(ans===${JSON.stringify(answerVal)}){${actionCode}}`);
          });

          // Check for Else row
          const elseRow = listElem.querySelector('.else-action-row');
          if (elseRow) {
            const actionType = elseRow.querySelector('select').value;
            const actionVal = elseRow.querySelector('input').value.trim();
            let elseCode = '';
            if (actionType === 'alert') {
              elseCode = `alert(${JSON.stringify(actionVal)});`;
            } else if (actionType === 'log') {
              elseCode = `console.log(${JSON.stringify(actionVal)});`;
            } else if (actionType === 'changeBg') {
              elseCode = `document.body.style.backgroundColor=${JSON.stringify(actionVal)};`;
            }
            if (conditions.length > 0) {
              // Chain if/else if and finish with else
              let ifElseCode = conditions
                .map((cond, i) => i === 0 ? cond : cond.replace(/^if/, 'else if'))
                .join(' ');
              ifElseCode += ` else {${elseCode}}`;
              codeSteps.push(ifElseCode);
            } else {
              // Only else
              codeSteps.push(`{${elseCode}}`);
            }
          } else {
            // No Else, just the ifs
            codeSteps.push(conditions.join(' '));
          }
        } else if (type === 'hideImages') {
          codeSteps.push('document.querySelectorAll("img").forEach(img => img.style.display="none");');
        } else if (type === 'replaceWords') {
          const inputs = block.querySelectorAll('.block-input');
          const findWord = inputs[0].value.trim();
          const replaceWord = inputs[1].value.trim();
          if (findWord && replaceWord) {
            codeSteps.push(
              `document.body.innerHTML=document.body.innerHTML.replace(new RegExp(${JSON.stringify(findWord)},'g'),${JSON.stringify(replaceWord)});`
            );
          }
        } else if (type === 'insertText') {
          const text = block.querySelector('.block-input').value.trim();
          const position = block.querySelector('.block-select').value;
          if (text) {
            codeSteps.push(
              `var div=document.createElement("div");div.textContent=${JSON.stringify(text)};` +
              (position === 'top'
                ? 'document.body.prepend(div);'
                : 'document.body.append(div);')
            );
          }
        } else if (type === 'visualEffect') {
          const effect = block.querySelector('.block-select').value;
          if (effect === 'danceParty') {
            codeSteps.push(`
              document.querySelectorAll('*').forEach(e => {
                e.style.transition = 'transform 0.2s';
                let i = 0;
                const interval = setInterval(() => {
                  e.style.transform = 'rotate(' + (Math.sin(i)*10) + 'deg)';
                  i += 0.2;
                }, 100);
                setTimeout(() => { clearInterval(interval); e.style.transform = ''; }, 2000);
              });
            `);
          } else if (effect === 'confetti') {
            codeSteps.push(`
              (function(){
                for(let i=0;i<80;i++){
                  var d=document.createElement('div');
                  d.textContent='üéâ';
                  d.style.position='fixed';
                  d.style.left=Math.random()*100+'vw';
                  d.style.top=Math.random()*100+'vh';
                  d.style.fontSize=(30+Math.random()*30)+'px';
                  d.style.pointerEvents='none';
                  document.body.appendChild(d);
                  setTimeout(()=>d.remove(), 2000+Math.random()*1000);
                }
              })();
            `);
          } else if (effect === 'invertColors') {
            codeSteps.push(`
              document.body.style.filter = 'invert(1)';
              setTimeout(()=>{document.body.style.filter='';}, 3000);
            `);
          } else if (effect === 'rainbowBg') {
            codeSteps.push(`
              let rainbowInt = setInterval(()=>{
                let h = Math.floor(Math.random()*360);
                document.body.style.backgroundColor='hsl('+h+',100%,70%)';
              },200);
              setTimeout(()=>{clearInterval(rainbowInt);document.body.style.backgroundColor='';},3000);
            `);
          } else if (effect === 'shakeEverything') {
            codeSteps.push(`
              document.querySelectorAll('*').forEach(e=>{
                e.style.animation='shake 0.5s';
                e.style.animationIterationCount='infinite';
              });
              var style=document.createElement('style');
              style.textContent='@keyframes shake{0%{transform:translate(0,0)}20%{transform:translate(-5px,0)}40%{transform:translate(5px,0)}60%{transform:translate(-5px,0)}80%{transform:translate(5px[...]
              document.head.appendChild(style);
              setTimeout(()=>{
                document.querySelectorAll('*').forEach(e=>{e.style.animation='';});
                style.remove();
              },2000);
            `);
          }
        }
      }
      const bookmarkletCode = 'javascript:(function(){' + codeSteps.join(' ') + '})();';
      document.getElementById('bookmarkletOutput').value = bookmarkletCode.replace(/\s+/g, ' ');
    };

    // Copy to clipboard
    document.getElementById('copyButton').onclick = function() {
      const outputField = document.getElementById('bookmarkletOutput');
      outputField.select();
      outputField.setSelectionRange(0, 99999); // For mobile devices
      navigator.clipboard.writeText(outputField.value).then(() => {
        alert('Bookmarklet copied to clipboard!');
      }).catch(err => {
        console.error('Failed to copy bookmarklet:', err);
      });
    };
  </script>
</body>
</html>


